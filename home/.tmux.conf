#
# tmux configuration
# Author:   Alisue <lambdalisue@hashnote.net>
# URI:      http://hashnote.net/
# Platform: Linux, Mac OS X
#
set-environment -g TMUX_CONF      "$HOME/.tmux.conf"
set-environment -g TMUX_ROOT      "$HOME/.config/tmux"
set-environment -g TMUX_POWERLINE "$HOME/.config/tmux/bundle/tmux-powerline"

# enable utf-8
set-option -g utf8
set-option -g status-utf8 on
set-window-option -g utf8 on

# force to use 256 colors in tmux
set-option -g default-terminal   'xterm-256color'
set-option -g terminal-overrides 'xterm:colors=256'

# use zsh as a default shell if exists
# prefer /usr/local/bin/zsh
if 'test -x /usr/bin/zsh'       "set-option -g default-shell /usr/bin/zsh"
if 'test -x /usr/local/bin/zsh' "set-option -g default-shell /usr/local/bin/zsh"

# disable bells
set-option -g bell-action none

# enable scroll with mouse
#set-option -g mode-mouse on
#set-option -g mouse-resize-pane on
#set-option -g mouse-select-pane on
#set-option -g mouse-select-window on
set-option -g mouse on

# do not wait after ESC (vimmer use ESC a lot!)
set-option -sg escape-time 0

# start window/pane index from 1
set-option -g base-index 1
set-window-option -g pane-base-index 1

# reload .tmux.conf file
bind-key r source-file "$HOME/.tmux.conf" \; display "Reloaded: ~/.tmux.conf has been reloaded"

# key binding
source-file "$HOME/.config/tmux/tmux-vim.conf"
source-file "$HOME/.config/tmux/tmux-ssh.conf"

# status bar
set-option -g status-position top
#source-file "$HOME/.config/tmux/tmux-powerline.conf"

# Connect tmux buffer to system buffer (clipboard)
bind-key C-c run "tmux save-buffer - | xclip -selection clipboard -i"
bind-key C-v run "tmux set-buffer \"$(xclip -o)\"; tmux paste-buffer"

# Open new window with the current path
bind-key c new-window      -c '#{pane_current_path}'
bind-key v split-window -h -c '#{pane_current_path}'
bind-key s split-window -v -c '#{pane_current_path}'
if 'test "$(tmux -V)" = "tmux 1.8"' 'bind-key c new-window'
if 'test "$(tmux -V)" = "tmux 1.8"' 'bind-key v split-window -h'
if 'test "$(tmux -V)" = "tmux 1.8"' 'bind-key s split-window -v'

# Toggle pane synchronize
bind g setw synchronize-panes

# Plugins via Tmux Plugin Manager
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm'"
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @shell_mode 'vi'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'erikw/tmux-powerline'
set -g @plugin 'seebi/tmux-colors-solarized'
set -g @plugin 'nhdaly/tmux-scroll-copy-mode'
run '~/.tmux/plugins/tpm/tpm'

if 'test "$(uname)" = "Darwin"' "source-file $HOME/.tmux.osx.conf"
